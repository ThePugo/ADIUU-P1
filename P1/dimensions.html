<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet" href="style.css">
    <script src="javascript.js"></script>

    <!-- Refs -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
        crossorigin="anonymous"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"> </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-3-typeahead/4.0.2/bootstrap3-typeahead.min.js">
    </script>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" rel="stylesheet" />
    <title>PC Parts Dashboard</title>
</head>

<!-- NAVBAR -->

<body class="body-blue-background">
    <header>
        <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
            <div class="container-fluid">
                <a class="navbar-brand" href="/P1/">PC Parts Dashboard</a>
                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
                        <li class="nav-item active">
                            <a class="nav-link" href="https://www.uib.es/es/">UIB</a>
                        </li>
                        <li class="nav-item active">
                            <a class="nav-link"
                                href="https://www.kaggle.com/datasets/rohitmit98/pc-parts-by-type/data?select=CPU.csv">Data
                                Source</a>
                        </li>
                        <li class="nav-item active">
                            <a class="nav-link" href="specs.html">My PC Specs</a>
                        </li>
                        <li class="nav-item active">
                            <a class="nav-link" href="dimensions.html">Dimension Compatibility Checker</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>


    <!-- GRÁFICAS -->
    <div class="container-fluid">
        <div class="row justify-content-center">
            <div class="margin2 text-center">
                <b>
                    <p>Choose a PC Case</p>
                </b>
                <input type="text" class="typeahead" data-provide="typeahead" placeholder="Enter name of PC Case"
                    id="pcCaseInput" />
            </div>
        </div>
        <div class="row justify-content-center">
            <div class="text-center margin2">
                <b>
                    <p>Choose a PC Motherboard</p>
                </b>
                <input type="text" class="typeahead" data-provide="typeahead" placeholder="Enter name of PC Motherboard"
                    id="pcMoboInput" />
            </div>
        </div>
        <div class="row justify-content-center">
            <div class="text-center margin2">
                <b>
                    <p>Choose a PC PSU</p>
                </b>
                <input type="text" class="typeahead" data-provide="typeahead" placeholder="Enter name of PC PSU"
                    id="pcPSUInput" />
            </div>
        </div>
        <!-- Centra el botón en el medio de la página -->
        <div class="row justify-content-center mt-3">
            <button id="showDataButton">Check Compatibility</button>
        </div>
        <!-- Agrega un elemento HTML para mostrar los datos seleccionados -->
        <div id="selectedData" class="text-center"></div>
        <div id="verdict" class="text-center"></div>
        <!-- Agrega un elemento HTML para mostrar las imágenes -->
        <div id="images" class="text-center mt-3">
            <div class="row justify-content-around">
                <div class="col-md-4" id="imageCase">
                </div>
                <div class="col-md-4" id="imageMobo">
                </div>
                <div class="col-md-4" id="imagePsu">
                </div>
            </div>
        </div>
    </div>


    <script>
        $.ajax({
            url: 'conexion.php', // archivo php
            type: 'GET', // tipo de peticion HTTP
            success: function (data) {
                var obj = jQuery.parseJSON(data);
                var tower = obj.tower;
                var mobo = obj.mobo; // Nombres de PC Case
                var psu = obj.psu;     // Nombres de PC PSU
                // ...
                initializeTypeahead(tower, mobo, psu); // Inicializa Typeahead con los datos de las columnas
            }
        });

        function initializeTypeahead(towerData, moboData, psuData) {
            // Obtiene los valores de las columnas correspondientes
            var towerData = towerData.map(function (row) {
                return row[2] + " {" + row[5] + "}" + " [" + row[3] + "]";
            });
            var moboData = moboData.map(function (row) {
                return row[2] + " {" + row[7] + "}" + " [" + row[3] + "]";
            });
            var psuData = psuData.map(function (row) {
                return row[2] + " {" + row[6] + "}" + " [" + row[3] + "]";
            });

            // Inicializa las cajas de búsqueda con Typeahead
            $(".typeahead").each(function () {
                var $input = $(this);
                var sourceData;

                if ($input.attr('placeholder').includes('PC Case')) {
                    sourceData = towerData;
                } else if ($input.attr('placeholder').includes('PC PSU')) {
                    sourceData = psuData;
                } else {
                    sourceData = moboData;
                }

                $input.typeahead({
                    source: sourceData,
                    autoSelect: true,
                });

                $input.change(function () {
                    var current = $input.typeahead("getActive");
                    matches = [];

                    if (current) {
                        if (current.name == $input.val()) {
                            matches.push(current.name);
                        }
                    }
                });
            });
        }

        document.addEventListener("DOMContentLoaded", function () {
            // Captura el botón para mostrar los datos y el elemento para mostrar los datos seleccionados
            var showDataButton = document.getElementById("showDataButton");
            var selectedDataDiv = document.getElementById("selectedData");
            var imageCase = document.getElementById("imageCase");
            var imageMobo = document.getElementById("imageMobo");
            var imagePsu = document.getElementById("imagePsu");
            var verdict = document.getElementById("verdict");

            // Agrega un evento clic al botón para mostrar los datos
            showDataButton.addEventListener("click", function () {
                // Captura los valores de los campos de texto
                var pcCaseValue = document.getElementById("pcCaseInput").value;
                var pcMoboValue = document.getElementById("pcMoboInput").value;
                var pcPSUValue = document.getElementById("pcPSUInput").value;

                var caseName = pcCaseValue.split(' {')[0].split(' [')[0];
                var moboName = pcMoboValue.split(' {')[0].split(' [')[0];
                var psuName = pcPSUValue.split(' {')[0].split(' [')[0];

                // Muestra los datos seleccionados
                selectedDataDiv.innerHTML = "Case: " + caseName + "<br>Motherboard: " + moboName + "<br>PSU: " + psuName;

                // Elimina cualquier imagen existente antes de agregar nuevas imágenes
                while (imageCase.firstChild) {
                    imageCase.removeChild(imageCase.firstChild);
                }
                while (imageMobo.firstChild) {
                    imageMobo.removeChild(imageMobo.firstChild);
                }
                while (imagePsu.firstChild) {
                    imagePsu.removeChild(imagePsu.firstChild);
                }

                //imagen torre
                var startIndex = pcCaseValue.indexOf("[");
                var endIndex = pcCaseValue.indexOf("]");
                // Extrae la URL entre los corchetes
                if (startIndex !== -1 && endIndex !== -1) {
                    var caseImageUrl = pcCaseValue.substring(startIndex + 1, endIndex);
                }
                var imgCase = document.createElement("img");
                imgCase.src = caseImageUrl;
                imgCase.id = "imgcase";
                // Agrega la imagen al elemento
                imageCase.appendChild(imgCase);

                //imagen placa base
                startIndex = pcMoboValue.indexOf("[");
                endIndex = pcMoboValue.indexOf("]");
                // Extrae la URL entre los corchetes
                if (startIndex !== -1 && endIndex !== -1) {
                    var moboImageUrl = pcMoboValue.substring(startIndex + 1, endIndex);
                }
                var imgMobo = document.createElement('img');
                imgMobo.src = moboImageUrl;
                // Agrega la imagen al elemento
                imageMobo.appendChild(imgMobo);

                //imagen psu
                startIndex = pcPSUValue.indexOf("[");
                endIndex = pcPSUValue.indexOf("]");
                // Extrae la URL entre los corchetes
                if (startIndex !== -1 && endIndex !== -1) {
                    var psuImageUrl = pcPSUValue.substring(startIndex + 1, endIndex);
                }
                var imgPsu = document.createElement('img');
                imgPsu.src = psuImageUrl;
                // Agrega la imagen al elemento
                imagePsu.appendChild(imgPsu);

                //verificar compatibilidad
                //se extrae el factor de forma de cada componente
                startIndex = pcCaseValue.indexOf("{");
                endIndex = pcCaseValue.indexOf("}");
                if (startIndex !== -1 && endIndex !== -1) {
                    var formfactorcase = pcCaseValue.substring(startIndex + 1, endIndex);
                }
                startIndex = pcMoboValue.indexOf("{");
                endIndex = pcMoboValue.indexOf("}");
                if (startIndex !== -1 && endIndex !== -1) {
                    var formfactormobo = pcMoboValue.substring(startIndex + 1, endIndex);
                }
                startIndex = pcPSUValue.indexOf("{");
                endIndex = pcPSUValue.indexOf("}");
                if (startIndex !== -1 && endIndex !== -1) {
                    var formfactorpsu = pcPSUValue.substring(startIndex + 1, endIndex);
                }
                //tower: ATX, MicroATX, ITX
                //mobo: ATX, MicroATX, ITX
                //psu: SFX, ATX
                if (formfactorcase === "MicroATX" && formfactormobo === "MicroATX" && formfactorpsu === "ATX") {
                    verdict.innerHTML = "<br>Case: " + formfactorcase + "<br>Motherboard: " + formfactormobo + "<br>PSU: " + formfactorpsu +
                        "<br><br>MicroATX compatibility with ATX PSU.";
                } else if (formfactorcase === "MicroATX" && formfactormobo === "MicroATX" && formfactorpsu === "SFX") {
                    verdict.innerHTML = "<br>Case: " + formfactorcase + "<br>Motherboard: " + formfactormobo + "<br>PSU: " + formfactorpsu +
                        "<br><br>MicroATX compatibility with SFX PSU.";
                } else if (formfactorcase === "ITX" && formfactormobo === "ITX" && formfactorpsu === "SFX") {
                    verdict.innerHTML = "<br>Case: " + formfactorcase + "<br>Motherboard: " + formfactormobo + "<br>PSU: " + formfactorpsu +
                        "<br><br>ITX compatibility with SFX PSU.";
                } else if (formfactorcase === "ATX") {
                    verdict.innerHTML = "<br>Case: " + formfactorcase + "<br>Motherboard: " + formfactormobo + "<br>PSU: " + formfactorpsu +
                        "<br><br>Total ATX compatibility.";
                } else {
                    verdict.innerHTML = "<br>Case: " + formfactorcase + "<br>Motherboard: " + formfactormobo + "<br>PSU: " + formfactorpsu +
                        "<br><br>No compatibility.";
                }
            });
        });
    </script>


</body>

</html>
